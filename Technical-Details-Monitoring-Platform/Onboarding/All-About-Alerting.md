**The early days**
Historically, the Azure platform had no shared alerting capability. Some product groups created their own alerting capability and others combined their efforts, using Azure Monitor, Activity Log, Service Health, etc. ([source](https://docs.microsoft.com/en-us/azure/monitoring-and-diagnostics/monitoring-overview)).

**Now**
These Alert capabilities are now known as “classic” alerts. Resources such as Monitor, App Service, etc. would let you create “classic” Alerts direct from each resource’s portal blade. These would let you configure a webhook, email address, etc. for notification. Three ‘mainstream’ alert capabilities survived:
1.	Azure Monitoring (See Above)
2.	Log Analytics
3.	Application Insights

**The Monitoring Platform Today**
Our monitoring platform's back end code (specifically the Customer Integration endpoint) has the ability to receive an Alert from Log Analytics (item 2) via a webhook, or a custom notification ("ESS Custom Alert") using our custom monitoring agent. The ESS Custom Alert is generated by running Application Insights or Log Analytics queries in a customer's environment via our "Alert Framework" which is a key component of our Monitoring Agent. 
 
**The New World of Azure Alerting**
The Azure product team has consolidated and enhanced the Alerting platform and recently (June 2018) release it to the public. The Azure Monitor and Application Insights (item 1 & 3) are merged into an alerting standard moving forward. There are three new aspects to Azure Alerting.
 
1.	A new “Unified Alerting” platform exposed via Azure Monitor ([source](https://docs.microsoft.com/en-us/azure/monitoring-and-diagnostics/monitoring-overview-unified-alerts#overview)), which has a few benefits: 
- It uses Action Groups to define what actions to take when an Alert is fired (emailing, calling a webhook, etc.)
- Brings alert information into one UI under 
- Brings Log Analytics and Application Insights alerts into the Azure Portal
 
Unified Alerting (only) supports data sources of Metric, Activity log, and Scheduled queries (which are custom Kusto queries for Application Insights and Log Analytics).

Not all sources of metrics flow into the Azure Monitor pipeline yet – but they will do ([source](https://docs.microsoft.com/en-us/azure/monitoring-and-diagnostics/monitoring-data-sources)). A full list of supported metrics can be found here: https://docs.microsoft.com/en-us/azure/monitoring-and-diagnostics/monitoring-supported-metrics
 
2.	Features of the new types of alert: 
a.	Low-latency metric alerts ([source](https://docs.microsoft.com/en-us/azure/monitoring-and-diagnostics/monitoring-overview-unified-alerts#features-of-the-unified-alert-experience)) that offer us enhanced ability to support our customers
b.	(in preview): Metrics from Logs ([source](https://azure.microsoft.com/en-us/blog/faster-metric-alerts-for-logs-now-in-limited-public-preview/)): VM Logs going into Log Analytics can now be converted into Azure Monitor Metrics
 
3.	A brand new (1 June 2018) Enhanced Unified Alerting experience (source) which offers things such as: 
a.	View alerts across subscriptions
b.	Group alerts using Smart Groups (not currently supported by the ESS Monitoring Platform)
c.	Manage alert state. Note that for the ESS Monitoring Platform, we flow alerts into Microsoft's Incident Management tool (IcM) which then becomes the system of record, and so the Azure Alert State functionality is not used by our programme at this time.

**Implementation**
ESS monitoring is working toward the following implementation. 

Principles:
-	The new alert capability in Azure will be leading for ESS to use
-	For deployment (at scale) ARM will be used to deploy and configure the alerts
-	Current alert framework will keep on to exists for complex queries, heart beat (monitor the monitoring) and reporting (future)

Flow:
-	Every customer will have an Excel Sheet with all their alerts (derives from the master alert sheet)
-	There is a Alert generator that (in the end) takes the customer specific alert sheet  and produces two output files:
o	Alert Definition file for customer that will be feed into alerting framework
o	Alert ARM template containing the Activity, Metric and scheduled alerts for that customer. 
-	A script in the pipeline will aggregate through target resources to collect all Resource IDs of different support resource types
-	Alert ARM template will be part of monitoring agent deployment pipeline and Resource IDs will be fed into the template.

**Technical Documentation**
Documentation is scattered and inconsistent for the webhook formats for the new alert types. Bearing in mind the different data sources of Metric, Activity Log, App Insights and Log, it seems we have:
•	Metric (including alerts using the preview of Log Analytics Logs As Metrics): https://docs.microsoft.com/en-us/azure/monitoring-and-diagnostics/monitoring-near-real-time-metric-alerts#payload-schema 
•	Activity Log alerts: https://docs.microsoft.com/en-us/azure/monitoring-and-diagnostics/monitoring-activity-log-schema
•	App Insights:  TBC but probably https://docs.microsoft.com/en-us/azure/monitoring-and-diagnostics/monitor-alerts-unified-log-webhook#sample-payloads – although documentation is confusing
•	Log (analytics): https://docs.microsoft.com/en-us/azure/monitoring-and-diagnostics/monitor-alerts-unified-log-webhook#sample-payloads  

